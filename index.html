<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>bloatkill ‚Äî Windows Storage Remediation</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0d1117;--s1:#161b22;--s2:#21262d;--s3:#2d333b;
  --b1:#30363d;--b2:#444c56;
  --tx:#e6edf3;--mu:#7d8590;
  --ac:#58a6ff;--gn:#3fb950;--yw:#d29922;--or:#db6d28;--rd:#f85149;
  --mono:'SFMono-Regular',Consolas,'Liberation Mono',Menlo,monospace;
}
body{background:var(--bg);color:var(--tx);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;font-size:14px;line-height:1.5;min-height:100vh;display:flex;flex-direction:column}
a{color:var(--ac);text-decoration:none}

/* HEADER */
#hdr{height:56px;background:var(--s1);border-bottom:1px solid var(--b1);display:flex;align-items:center;justify-content:space-between;padding:0 20px;position:sticky;top:0;z-index:200;flex-shrink:0;gap:12px}
.logo{display:flex;align-items:center;gap:8px;font-weight:600;font-size:15px;color:var(--tx)}
.logo-icon{width:24px;height:24px;background:linear-gradient(135deg,#1f6feb,#58a6ff);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px}
.hdr-btns{display:flex;gap:8px;align-items:center}
.btn{display:inline-flex;align-items:center;gap:6px;padding:5px 12px;border-radius:6px;border:1px solid var(--b2);background:var(--s2);color:var(--tx);font-size:12px;cursor:pointer;font-family:inherit;transition:background .12s;white-space:nowrap}
.btn:hover{background:var(--s3)}
.btn-green{background:#238636;border-color:#2ea043;color:#fff}
.btn-green:hover{background:#2ea043}
.btn-icon{padding:5px 8px}

/* BODY */
#body{display:flex;flex:1;overflow:hidden}

/* SIDEBAR */
#sidebar{width:220px;min-width:220px;background:var(--s1);border-right:1px solid var(--b1);display:flex;flex-direction:column;padding:8px 0;overflow-y:auto;flex-shrink:0}
.sb-section{margin-bottom:4px}
.sb-label{padding:8px 16px 4px;font-size:11px;font-weight:600;color:var(--mu);text-transform:uppercase;letter-spacing:.06em}
.sb-link{display:flex;align-items:center;gap:8px;padding:6px 16px;color:var(--mu);cursor:pointer;font-size:13px;border:none;background:none;width:100%;text-align:left;border-radius:0;transition:background .1s,color .1s}
.sb-link:hover{background:var(--s2);color:var(--tx)}
.sb-link.active{background:var(--s2);color:var(--tx);font-weight:500}
.sb-link.action-link{color:var(--ac)}
.sb-link.action-link:hover{color:var(--tx)}
.sb-divider{height:1px;background:var(--b1);margin:8px 0}
.sb-icon{width:16px;text-align:center;flex-shrink:0}

/* CONTENT */
#content{flex:1;overflow-y:auto;padding:20px 24px}
.page{display:none}
.page.active{display:block}

/* PAGE HEADER */
.pg-hdr{margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid var(--b1)}
.pg-hdr h1{font-size:20px;font-weight:600;margin-bottom:4px}
.pg-hdr p{color:var(--mu);font-size:13px}

/* METRICS */
.metrics{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:12px;margin-bottom:20px}
.metric{background:var(--s1);border:1px solid var(--b1);border-radius:8px;padding:16px;cursor:default}
.metric:hover{border-color:var(--b2)}
.m-label{font-size:11px;color:var(--mu);font-weight:500;text-transform:uppercase;letter-spacing:.05em;margin-bottom:4px}
.m-val{font-size:28px;font-weight:700;line-height:1}
.m-sub{font-size:11px;color:var(--mu);margin-top:4px}
.c-gn{color:var(--gn)}.c-yw{color:var(--yw)}.c-or{color:var(--or)}.c-rd{color:var(--rd)}.c-ac{color:var(--ac)}.c-tx{color:var(--tx)}

/* FILTER BAR */
.filter-bar{display:flex;align-items:center;gap:8px;margin-bottom:16px;flex-wrap:wrap}
.filter-label{font-size:12px;color:var(--mu)}
.chip{padding:3px 10px;border-radius:20px;border:1px solid var(--b2);background:var(--s2);color:var(--tx);font-size:11px;font-weight:600;cursor:pointer;transition:all .12s;letter-spacing:.03em}
.chip:hover{border-color:var(--b2);opacity:.85}
.chip.active{box-shadow:0 0 0 2px rgba(255,255,255,.15)}
.chip-safe{background:#0d2119;border-color:var(--gn);color:var(--gn)}
.chip-low{background:#1e1a0e;border-color:var(--yw);color:var(--yw)}
.chip-medium{background:#1e140e;border-color:var(--or);color:var(--or)}
.chip-danger{background:#1e0e0e;border-color:var(--rd);color:var(--rd)}

/* CARD */
.card{background:var(--s1);border:1px solid var(--b1);border-radius:8px;margin-bottom:16px;overflow:hidden}
.card-hdr{padding:12px 16px;border-bottom:1px solid var(--b1);display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.card-hdr h3{font-size:14px;font-weight:600}
.card-body{padding:16px}

/* TABLE */
.tbl-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:13px}
thead th{padding:8px 12px;text-align:left;font-size:11px;font-weight:600;color:var(--mu);text-transform:uppercase;letter-spacing:.05em;border-bottom:1px solid var(--b1);cursor:pointer;user-select:none;white-space:nowrap}
thead th:hover{color:var(--tx)}
.sort-arrow{margin-left:3px;opacity:.4;font-size:10px}
tbody tr{border-bottom:1px solid var(--b1);transition:background .08s}
tbody tr:last-child{border-bottom:none}
tbody tr:hover{background:var(--s2)}
td{padding:9px 12px;vertical-align:middle}
.td-mono{font-family:var(--mono);font-size:12px;color:#a5d6ff}

/* BADGES */
.badge{display:inline-flex;align-items:center;padding:2px 8px;border-radius:20px;font-size:11px;font-weight:600;letter-spacing:.03em;border:1px solid transparent}
.badge-safe{background:#0d2119;border-color:var(--gn);color:var(--gn)}
.badge-low{background:#1e1a0e;border-color:var(--yw);color:var(--yw)}
.badge-medium{background:#1e140e;border-color:var(--or);color:var(--or)}
.badge-danger{background:#1e0e0e;border-color:var(--rd);color:var(--rd)}
.badge-done{background:#0d1f2d;border-color:var(--ac);color:var(--ac)}
.badge-pending{background:var(--s2);border-color:var(--b2);color:var(--mu)}

/* SEARCH */
.srch-wrap{position:relative;flex:1;max-width:260px}
.srch-wrap input{width:100%;padding:5px 10px 5px 28px;background:var(--bg);border:1px solid var(--b2);border-radius:6px;color:var(--tx);font-size:13px;font-family:inherit;outline:none;transition:border-color .12s}
.srch-wrap input:focus{border-color:var(--ac)}
.srch-ico{position:absolute;left:8px;top:50%;transform:translateY(-50%);color:var(--mu);font-size:12px;pointer-events:none}

/* CODE BLOCK */
.code-wrap{position:relative;margin-top:10px}
.code-block{background:var(--bg);border:1px solid var(--b1);border-radius:6px;padding:12px 14px;font-family:var(--mono);font-size:12px;line-height:1.7;color:#a5d6ff;overflow-x:auto;white-space:pre}
.copy-btn{position:absolute;top:8px;right:8px;padding:3px 8px;background:var(--s2);border:1px solid var(--b2);border-radius:4px;color:var(--mu);font-size:11px;cursor:pointer;font-family:inherit;transition:all .12s}
.copy-btn:hover{background:var(--s3);color:var(--tx)}
.copy-btn.ok{color:var(--gn);border-color:var(--gn)}

/* EXPAND ROW */
.exp-toggle{color:var(--mu);font-size:11px;transition:transform .15s;display:inline-block;margin-right:4px}
tr.expanded .exp-toggle{transform:rotate(90deg)}
.detail-row td{padding:0!important;background:var(--bg)}
.detail-inner{padding:16px;display:none}
.detail-inner.show{display:block}

/* RISK BAR */
.risk-bar{display:inline-flex;align-items:center;gap:8px;width:100%}
.bar-track{height:6px;border-radius:3px;background:var(--s3);flex:1;min-width:60px;overflow:hidden}
.bar-fill{height:100%;border-radius:3px}

/* ABOUT */
.about-section{margin-bottom:24px}
.about-section h3{font-size:15px;font-weight:600;margin-bottom:8px;padding-bottom:8px;border-bottom:1px solid var(--b1)}
.about-section p{color:var(--mu);font-size:13px;line-height:1.7;margin-bottom:8px}
.about-section ul{color:var(--mu);font-size:13px;line-height:1.7;padding-left:20px}
.about-section ul li{margin-bottom:4px}
.about-section ul li strong{color:var(--tx)}
.kv-grid{display:grid;grid-template-columns:auto 1fr;gap:4px 16px;font-size:13px}
.kv-key{font-weight:600;color:var(--tx);white-space:nowrap;padding:4px 0}
.kv-val{color:var(--mu);padding:4px 0}
kbd{display:inline-block;padding:1px 6px;background:var(--s2);border:1px solid var(--b2);border-radius:4px;font-family:var(--mono);font-size:11px;color:var(--tx)}

/* SHORTCUT PANEL */
#kp{display:none;position:fixed;bottom:20px;right:20px;background:var(--s1);border:1px solid var(--b2);border-radius:8px;padding:16px;z-index:500;min-width:230px;box-shadow:0 8px 32px #0009}
#kp.show{display:block}
#kp h4{font-size:13px;font-weight:600;margin-bottom:10px}
.kp-row{display:flex;justify-content:space-between;gap:12px;font-size:12px;color:var(--mu);margin-bottom:6px}
.kp-row kbd{color:var(--tx)}

/* FOOTER */
#ftr{border-top:1px solid var(--b1);padding:12px 24px;display:flex;justify-content:space-between;align-items:center;font-size:12px;color:var(--mu);flex-shrink:0;background:var(--s1)}
#ftr a{color:var(--mu)}
#ftr a:hover{color:var(--ac)}

/* ALERT */
.alert{padding:12px 16px;border-radius:6px;font-size:13px;margin-bottom:16px;display:flex;align-items:flex-start;gap:10px}
.alert-warn{background:#1e1a0e;border:1px solid var(--yw)}
.alert-danger{background:#1e0e0e;border:1px solid var(--rd)}
.alert-info{background:#0d1f2d;border:1px solid var(--ac)}

/* STATUS DOT */
.dot{width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:4px}
.dot-gn{background:var(--gn)}.dot-yw{background:var(--yw)}.dot-rd{background:var(--rd)}.dot-or{background:var(--or)}
</style>
</head>
<body>

<!-- HEADER -->
<header id="hdr">
  <div class="logo">
    <div class="logo-icon">üíÄ</div>
    <span>bloatkill</span>
  </div>
  <div class="hdr-btns">
    <button class="btn btn-green" onclick="runCleanup()">‚ñ∂ Run Cleanup Scan</button>
    <button class="btn" onclick="copyCommand()">üìã Copy Command</button>
    <button class="btn" onclick="exportCSV()">‚¨á Export CSV</button>
    <button class="btn btn-icon" onclick="toggleKP()" title="Keyboard shortcuts">?</button>
  </div>
</header>

<!-- BODY -->
<div id="body">

  <!-- SIDEBAR -->
  <nav id="sidebar">
    <div class="sb-section">
      <div class="sb-label">Navigation</div>
      <button class="sb-link active" onclick="showPage('overview',this)">
        <span class="sb-icon">üìä</span> Overview
      </button>
      <button class="sb-link" onclick="showPage('folders',this)">
        <span class="sb-icon">üìÅ</span> Folder Details
      </button>
      <button class="sb-link" onclick="showPage('methods',this)">
        <span class="sb-icon">üîß</span> Cleanup Methods
      </button>
      <button class="sb-link" onclick="showPage('runs',this)">
        <span class="sb-icon">üìã</span> Run History
      </button>
      <button class="sb-link" onclick="showPage('about',this)">
        <span class="sb-icon">‚Ñπ</span> About
      </button>
    </div>
    <div class="sb-divider"></div>
    <div class="sb-section sb-actions">
      <div class="sb-label">Actions</div>
      <button class="sb-link action-link" onclick="runCleanup()">
        <span class="sb-icon">‚ñ∂</span> Run Cleanup Scan
      </button>
      <button class="sb-link action-link" onclick="copyCommand()">
        <span class="sb-icon">üìã</span> Copy Command
      </button>
      <button class="sb-link action-link" onclick="exportCSV()">
        <span class="sb-icon">‚¨á</span> Export CSV
      </button>
    </div>
  </nav>

  <!-- CONTENT -->
  <main id="content">

    <!-- ‚îÄ‚îÄ OVERVIEW ‚îÄ‚îÄ -->
    <div id="page-overview" class="page active">
      <div class="pg-hdr">
        <h1>Overview</h1>
        <p>Windows storage bloat analysis across WinSxS and Installer folders. Last scan: <strong>2026-02-26 06:00 UTC</strong></p>
      </div>

      <div class="metrics">
        <div class="metric" title="Total reclaimable space identified across all targets">
          <div class="m-label">Reclaimable</div>
          <div class="m-val c-ac">18.4 <span style="font-size:16px">GB</span></div>
          <div class="m-sub">across 2 folders</div>
        </div>
        <div class="metric" title="Space already recovered by previous cleanup runs">
          <div class="m-label">Recovered</div>
          <div class="m-val c-gn">6.2 <span style="font-size:16px">GB</span></div>
          <div class="m-sub">this month</div>
        </div>
        <div class="metric" title="Percentage of reclaimable space cleaned">
          <div class="m-label">Clean Rate</div>
          <div class="m-val c-yw">34%</div>
          <div class="m-sub">target ‚â•80%</div>
        </div>
        <div class="metric" title="Orphaned installer files with no registered MSI owner">
          <div class="m-label">Orphaned MSIs</div>
          <div class="m-val c-or">142</div>
          <div class="m-sub">in C:\Windows\Installer</div>
        </div>
        <div class="metric" title="Superseded Windows component versions safe to remove">
          <div class="m-label">Superseded</div>
          <div class="m-val c-yw">89</div>
          <div class="m-sub">WinSxS components</div>
        </div>
        <div class="metric" title="Cleanup methods available across all risk levels">
          <div class="m-label">Methods</div>
          <div class="m-val c-tx">8</div>
          <div class="m-sub">SAFE ‚Üí DANGER</div>
        </div>
      </div>

      <!-- Filter -->
      <div class="filter-bar">
        <span class="filter-label">Risk:</span>
        <span class="chip active" onclick="filterAll(this)">All</span>
        <span class="chip chip-safe" onclick="filterChip(this,'safe')">SAFE</span>
        <span class="chip chip-low" onclick="filterChip(this,'low')">LOW</span>
        <span class="chip chip-medium" onclick="filterChip(this,'medium')">MEDIUM</span>
        <span class="chip chip-danger" onclick="filterChip(this,'danger')">DANGER</span>
      </div>

      <!-- Top riskiest folders -->
      <div class="card">
        <div class="card-hdr"><h3>üìÅ Target Folders</h3></div>
        <div class="tbl-wrap">
          <table id="tbl-folders-ov">
            <thead>
              <tr>
                <th onclick="sortTable('tbl-folders-ov',0)">Folder <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-folders-ov',1)">Path <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-folders-ov',2)">Est. Size <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-folders-ov',3)">Reclaimable <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-folders-ov',4)">Status <span class="sort-arrow">‚Üï</span></th>
                <th>Risk Level</th>
              </tr>
            </thead>
            <tbody>
              <tr data-risk="medium">
                <td><strong>WinSxS</strong></td>
                <td class="td-mono">C:\Windows\WinSxS</td>
                <td>12.3 GB</td>
                <td class="c-yw">4.1 GB</td>
                <td><span class="dot dot-yw"></span>Partially Cleaned</td>
                <td><span class="badge badge-medium">MEDIUM</span></td>
              </tr>
              <tr data-risk="danger">
                <td><strong>Installer</strong></td>
                <td class="td-mono">C:\Windows\Installer</td>
                <td>8.6 GB</td>
                <td class="c-or">14.3 GB</td>
                <td><span class="dot dot-rd"></span>Needs Attention</td>
                <td><span class="badge badge-danger">DANGER</span></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Summary -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
        <div class="card">
          <div class="card-hdr"><h3>‚ö° Quick Actions</h3></div>
          <div class="card-body" style="display:flex;flex-direction:column;gap:8px">
            <button class="btn btn-green" style="justify-content:center" onclick="copyText('Dism.exe /online /Cleanup-Image /StartComponentCleanup')">Run DISM ComponentCleanup</button>
            <button class="btn" style="justify-content:center" onclick="copyText('cleanmgr /sageset:1')">Launch Disk Cleanup (sageset)</button>
            <button class="btn" style="justify-content:center" onclick="showPage('methods', document.querySelector(\'[onclick*=methods]\'))">View All Methods ‚Üí</button>
          </div>
        </div>
        <div class="card">
          <div class="card-hdr"><h3>‚ö† Warnings</h3></div>
          <div class="card-body" style="display:flex;flex-direction:column;gap:8px">
            <div class="alert alert-danger">
              <span>üî¥</span>
              <span>Never manually delete files inside WinSxS ‚Äî OS managed only.</span>
            </div>
            <div class="alert alert-warn">
              <span>üü°</span>
              <span>142 orphaned MSI files detected in Installer folder ‚Äî review before deleting.</span>
            </div>
            <div class="alert alert-info">
              <span>üîµ</span>
              <span>ResetBase is irreversible ‚Äî disables update rollback permanently.</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ FOLDER DETAILS ‚îÄ‚îÄ -->
    <div id="page-folders" class="page">
      <div class="pg-hdr">
        <h1>Folder Details</h1>
        <p>Per-folder breakdown, orphan analysis, and component inventory.</p>
      </div>

      <div class="filter-bar">
        <span class="filter-label">Risk:</span>
        <span class="chip active" onclick="filterAll(this)">All</span>
        <span class="chip chip-safe" onclick="filterChip(this,'safe')">SAFE</span>
        <span class="chip chip-low" onclick="filterChip(this,'low')">LOW</span>
        <span class="chip chip-medium" onclick="filterChip(this,'medium')">MEDIUM</span>
        <span class="chip chip-danger" onclick="filterChip(this,'danger')">DANGER</span>
        <div class="srch-wrap" style="margin-left:auto">
          <span class="srch-ico">üîç</span>
          <input type="text" placeholder="Search folders..." oninput="searchTable('tbl-folders-detail',this.value)">
        </div>
      </div>

      <div class="card">
        <div class="card-hdr"><h3>üìÅ Folder Inventory</h3><span style="color:var(--mu);font-size:12px">Click row to expand</span></div>
        <div class="tbl-wrap">
          <table id="tbl-folders-detail">
            <thead>
              <tr>
                <th></th>
                <th onclick="sortTable('tbl-folders-detail',1)">Folder <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-folders-detail',2)">Path <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-folders-detail',3)">Total Size <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-folders-detail',4)">Reclaimable <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-folders-detail',5)">File Count <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-folders-detail',6)">Risk <span class="sort-arrow">‚Üï</span></th>
              </tr>
            </thead>
            <tbody>
              <tr class="exp-toggle-row" data-risk="medium" onclick="expandRow(this,'detail-winsxs')">
                <td><span class="exp-toggle">‚ñ∂</span></td>
                <td><strong>WinSxS</strong></td>
                <td class="td-mono">C:\Windows\WinSxS</td>
                <td>12.3 GB</td>
                <td class="c-yw">4.1 GB</td>
                <td>34,892</td>
                <td><span class="badge badge-medium">MEDIUM</span></td>
              </tr>
              <tr class="detail-row"><td colspan="7"><div class="detail-inner" id="detail-winsxs">
                <p style="color:var(--mu);font-size:13px;margin-bottom:12px">The <strong style="color:var(--tx)">Windows Component Store</strong> (WinSxS) houses every version of every Windows component ever installed ‚Äî including superseded updates and rollback data. Windows manages this folder exclusively; manual deletion will corrupt the OS.</p>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
                  <div>
                    <div style="font-size:11px;color:var(--mu);font-weight:600;text-transform:uppercase;letter-spacing:.05em;margin-bottom:8px">Breakdown</div>
                    <div class="kv-grid">
                      <div class="kv-key">Active Components</div><div class="kv-val">~8.2 GB</div>
                      <div class="kv-key">Superseded</div><div class="kv-val c-yw">~4.1 GB</div>
                      <div class="kv-key">Rollback Data</div><div class="kv-val">included</div>
                      <div class="kv-key">OS Managed</div><div class="kv-val c-gn">Yes</div>
                    </div>
                  </div>
                  <div>
                    <div style="font-size:11px;color:var(--mu);font-weight:600;text-transform:uppercase;letter-spacing:.05em;margin-bottom:8px">Recommended Tool</div>
                    <div class="code-wrap"><pre class="code-block">Dism.exe /online /Cleanup-Image /StartComponentCleanup</pre><button class="copy-btn" onclick="copyText('Dism.exe /online /Cleanup-Image /StartComponentCleanup',this)">Copy</button></div>
                  </div>
                </div>
              </div></td></tr>

              <tr class="exp-toggle-row" data-risk="danger" onclick="expandRow(this,'detail-installer')">
                <td><span class="exp-toggle">‚ñ∂</span></td>
                <td><strong>Installer</strong></td>
                <td class="td-mono">C:\Windows\Installer</td>
                <td>8.6 GB</td>
                <td class="c-or">14.3 GB</td>
                <td>6,241</td>
                <td><span class="badge badge-danger">DANGER</span></td>
              </tr>
              <tr class="detail-row"><td colspan="7"><div class="detail-inner" id="detail-installer">
                <p style="color:var(--mu);font-size:13px;margin-bottom:12px">The <strong style="color:var(--tx)">Windows Installer Cache</strong> stores .msi and .msp patch files used for repair, modify, and uninstall. Orphaned files accumulate over years of software churn. Deleting active patch files breaks repair/uninstall of installed apps ‚Äî always verify orphans before removal.</p>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
                  <div>
                    <div style="font-size:11px;color:var(--mu);font-weight:600;text-transform:uppercase;letter-spacing:.05em;margin-bottom:8px">Breakdown</div>
                    <div class="kv-grid">
                      <div class="kv-key">Active (.msi/.msp)</div><div class="kv-val c-gn">~3.2 GB</div>
                      <div class="kv-key">Orphaned</div><div class="kv-val c-rd">~5.4 GB (142 files)</div>
                      <div class="kv-key">Safe to Remove</div><div class="kv-val c-or">After verification only</div>
                      <div class="kv-key">OS Managed</div><div class="kv-val c-rd">No</div>
                    </div>
                  </div>
                  <div>
                    <div style="font-size:11px;color:var(--mu);font-weight:600;text-transform:uppercase;letter-spacing:.05em;margin-bottom:8px">Detect Orphans (PowerShell)</div>
                    <div class="code-wrap"><pre class="code-block">$valid = Get-ChildItem "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\UserData" -Recurse |
  Where-Object {$_.Property -contains "LocalPackage"} |
  ForEach-Object {(Get-ItemProperty $_.PSPath).LocalPackage}

Get-ChildItem "C:\Windows\Installer\*.ms?" |
  Where-Object {$_.FullName -notin $valid} |
  Select-Object FullName,@{N="MB";E={[math]::Round($_.Length/1MB,1)}}</pre><button class="copy-btn" onclick="copyText(this.previousSibling.textContent,this)">Copy</button></div>
                  </div>
                </div>
              </div></td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ CLEANUP METHODS ‚îÄ‚îÄ -->
    <div id="page-methods" class="page">
      <div class="pg-hdr">
        <h1>Cleanup Methods</h1>
        <p>All available remediation commands, sorted by folder and risk level. Click a row to expand and copy.</p>
      </div>

      <div class="filter-bar">
        <span class="filter-label">Risk:</span>
        <span class="chip active" onclick="filterAll(this)">All</span>
        <span class="chip chip-safe" onclick="filterChip(this,'safe')">SAFE</span>
        <span class="chip chip-low" onclick="filterChip(this,'low')">LOW</span>
        <span class="chip chip-medium" onclick="filterChip(this,'medium')">MEDIUM</span>
        <span class="chip chip-danger" onclick="filterChip(this,'danger')">DANGER</span>
        <div class="srch-wrap" style="margin-left:auto">
          <span class="srch-ico">üîç</span>
          <input type="text" placeholder="Search methods..." oninput="searchTable('tbl-methods',this.value)">
        </div>
      </div>

      <div class="card">
        <div class="card-hdr">
          <h3>üîß Remediation Commands</h3>
          <span style="color:var(--mu);font-size:12px">8 methods ¬∑ Click row to expand command</span>
        </div>
        <div class="tbl-wrap">
          <table id="tbl-methods">
            <thead>
              <tr>
                <th></th>
                <th onclick="sortTable('tbl-methods',1)">Method <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-methods',2)">Folder <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-methods',3)">Tool <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-methods',4)">Est. Savings <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-methods',5)">Risk <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-methods',6)">Status <span class="sort-arrow">‚Üï</span></th>
              </tr>
            </thead>
            <tbody id="methods-body">
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ RUN HISTORY ‚îÄ‚îÄ -->
    <div id="page-runs" class="page">
      <div class="pg-hdr">
        <h1>Run History</h1>
        <p>Log of all cleanup scans and executions across this machine.</p>
      </div>

      <div class="filter-bar">
        <div class="srch-wrap">
          <span class="srch-ico">üîç</span>
          <input type="text" placeholder="Search runs..." oninput="searchTable('tbl-runs',this.value)">
        </div>
        <button class="btn" style="margin-left:auto" onclick="exportCSV()">‚¨á Export CSV</button>
      </div>

      <div class="card">
        <div class="tbl-wrap">
          <table id="tbl-runs">
            <thead>
              <tr>
                <th onclick="sortTable('tbl-runs',0)">Timestamp <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-runs',1)">Method <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-runs',2)">Folder <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-runs',3)">Reclaimed <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-runs',4)">Duration <span class="sort-arrow">‚Üï</span></th>
                <th onclick="sortTable('tbl-runs',5)">Result <span class="sort-arrow">‚Üï</span></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="td-mono">2026-02-26 06:02 UTC</td>
                <td>DISM StartComponentCleanup</td>
                <td>WinSxS</td>
                <td class="c-gn">2.1 GB</td>
                <td>4m 12s</td>
                <td><span class="badge badge-done">SUCCESS</span></td>
              </tr>
              <tr>
                <td class="td-mono">2026-02-19 06:01 UTC</td>
                <td>Disk Cleanup (sageset)</td>
                <td>WinSxS</td>
                <td class="c-gn">1.4 GB</td>
                <td>2m 38s</td>
                <td><span class="badge badge-done">SUCCESS</span></td>
              </tr>
              <tr>
                <td class="td-mono">2026-02-12 06:00 UTC</td>
                <td>PowerShell Orphan Detect</td>
                <td>Installer</td>
                <td class="c-mu">0 GB (scan only)</td>
                <td>0m 47s</td>
                <td><span class="badge badge-done">SUCCESS</span></td>
              </tr>
              <tr>
                <td class="td-mono">2026-02-05 06:00 UTC</td>
                <td>PatchCleaner</td>
                <td>Installer</td>
                <td class="c-gn">2.7 GB</td>
                <td>8m 03s</td>
                <td><span class="badge badge-done">SUCCESS</span></td>
              </tr>
              <tr>
                <td class="td-mono">2026-01-29 06:00 UTC</td>
                <td>DISM StartComponentCleanup</td>
                <td>WinSxS</td>
                <td class="c-rd">0 GB</td>
                <td>1m 12s</td>
                <td><span class="badge badge-pending">NO CHANGE</span></td>
              </tr>
              <tr>
                <td class="td-mono">2026-01-22 06:01 UTC</td>
                <td>DISM ResetBase</td>
                <td>WinSxS</td>
                <td class="c-gn">3.8 GB</td>
                <td>12m 44s</td>
                <td><span class="badge badge-danger">IRREVERSIBLE</span></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ ABOUT ‚îÄ‚îÄ -->
    <div id="page-about" class="page">
      <div class="pg-hdr">
        <h1>About bloatkill</h1>
        <p>Windows storage remediation dashboard ‚Äî part of the ry-ops infrastructure automation suite.</p>
      </div>

      <div class="about-section">
        <h3>What is bloatkill?</h3>
        <p><strong style="color:var(--tx)">bloatkill</strong> is a GitOps-style dashboard for tracking, auditing, and executing Windows storage remediation across the WinSxS Component Store and Windows Installer cache. It surfaces orphaned files, superseded components, and reclaimable space ‚Äî and provides copy-ready PowerShell and DISM commands for remediation.</p>
        <p>This dashboard integrates with the <a href="https://ry-ops.dev">ry-ops</a> infrastructure automation stack, providing the same operational visibility as <a href="https://github.com/ry-ops/git-steer">git-steer</a> does for GitHub security posture.</p>
      </div>

      <div class="about-section">
        <h3>Reading the Metrics</h3>
        <div class="kv-grid">
          <div class="kv-key">Reclaimable</div><div class="kv-val">Total disk space that can be safely freed across all target folders.</div>
          <div class="kv-key">Recovered</div><div class="kv-val">Space freed by cleanup runs this calendar month.</div>
          <div class="kv-key">Clean Rate</div><div class="kv-val">Percentage of reclaimable space that has been addressed. Target ‚â•80%.</div>
          <div class="kv-key">Orphaned MSIs</div><div class="kv-val">Installer files with no registered MSI owner in the registry ‚Äî safe candidates for removal after verification.</div>
          <div class="kv-key">Superseded</div><div class="kv-val">WinSxS component versions replaced by newer updates ‚Äî removable via DISM.</div>
        </div>
      </div>

      <div class="about-section">
        <h3>Dashboard Features</h3>
        <ul>
          <li><strong>4 tabs</strong>: Overview, Folder Details, Cleanup Methods, Run History</li>
          <li><strong>Global risk filter</strong>: SAFE / LOW / MEDIUM / DANGER across all tabs</li>
          <li><strong>Sortable tables</strong>: Click any column header</li>
          <li><strong>Live search</strong>: Filter tables in real time</li>
          <li><strong>Expandable rows</strong>: Click to reveal full command and context</li>
          <li><strong>Click-to-copy</strong>: Every command has a one-click copy button</li>
          <li><strong>CSV export</strong>: Download current tab data</li>
        </ul>
      </div>

      <div class="about-section">
        <h3>Keyboard Shortcuts</h3>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;max-width:400px">
          <div><kbd>1</kbd>‚Äì<kbd>4</kbd> Switch tabs</div>
          <div><kbd>Esc</kbd> Close panels</div>
          <div><kbd>?</kbd> Toggle shortcuts</div>
          <div><kbd>/</kbd> Focus search</div>
        </div>
      </div>

      <div class="about-section">
        <h3>Links</h3>
        <ul>
          <li><a href="https://ry-ops.dev">ry-ops.dev ‚Äî Technical blog</a></li>
          <li><a href="https://github.com/ry-ops/git-steer">git-steer on GitHub</a></li>
          <li><a href="https://github.com/ry-ops">ry-ops GitHub org</a></li>
        </ul>
      </div>
    </div>

  </main>
</div>

<!-- FOOTER -->
<footer id="ftr">
  <span>Powered by <a href="https://ry-ops.dev">ry-ops/bloatkill</a> ¬∑ Last scan: 2026-02-26 06:00 UTC</span>
  <span>Open Issues: <strong style="color:var(--or)">2</strong> ¬∑ Methods Available: <strong style="color:var(--ac)">8</strong></span>
</footer>

<!-- SHORTCUT PANEL -->
<div id="kp">
  <h4>‚å® Keyboard Shortcuts</h4>
  <div class="kp-row"><span><kbd>1</kbd>‚Äì<kbd>4</kbd></span><span>Switch tabs</span></div>
  <div class="kp-row"><span><kbd>Esc</kbd></span><span>Close this panel</span></div>
  <div class="kp-row"><span><kbd>?</kbd></span><span>Toggle shortcuts</span></div>
  <div class="kp-row"><span><kbd>/</kbd></span><span>Focus search</span></div>
</div>

<script>
// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ
const methods = [
  {name:'WinSxS Size Audit',folder:'WinSxS',tool:'PowerShell',savings:'0 (scan only)',risk:'safe',status:'done',
   cmd:`Get-ChildItem C:\\Windows\\WinSxS | Measure-Object -Property Length -Sum |\n  Select-Object @{N="Size(GB)";E={[math]::Round($_.Sum/1GB,2)}}`,
   note:'Accurate WinSxS size audit. Run before any cleanup to establish baseline.'},
  {name:'Disk Cleanup (sageset)',folder:'WinSxS',tool:'cleanmgr',savings:'1‚Äì3 GB',risk:'low',status:'done',
   cmd:'cleanmgr /sageset:1\ncleanmgr /sagerun:1',
   note:"Run sageset first to configure options ‚Äî select 'Windows Update Cleanup'. Then sagerun to execute."},
  {name:'DISM StartComponentCleanup',folder:'WinSxS',tool:'DISM',savings:'2‚Äì5 GB',risk:'low',status:'done',
   cmd:'Dism.exe /online /Cleanup-Image /StartComponentCleanup',
   note:'Removes superseded component versions after the 30-day safety window. Safe and recommended.'},
  {name:'DISM ResetBase',folder:'WinSxS',tool:'DISM',savings:'3‚Äì8 GB',risk:'danger',status:'pending',
   cmd:'Dism.exe /online /Cleanup-Image /StartComponentCleanup /ResetBase',
   note:'Removes ALL superseded components. Permanently disables rollback of installed updates. IRREVERSIBLE ‚Äî use only when storage is critically low.'},
  {name:'Orphan Detection Script',folder:'Installer',tool:'PowerShell',savings:'0 (scan only)',risk:'safe',status:'done',
   cmd:`$valid = Get-ChildItem "HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Installer\\UserData" -Recurse |\n  Where-Object {$_.Property -contains "LocalPackage"} |\n  ForEach-Object {(Get-ItemProperty $_.PSPath).LocalPackage}\n\nGet-ChildItem "C:\\Windows\\Installer\\*.ms?" |\n  Where-Object {$_.FullName -notin $valid} |\n  Select-Object FullName,@{N="MB";E={[math]::Round($_.Length/1MB,1)}}`,
   note:'Cross-references registry against disk files to identify true orphans. Review output before deleting anything.'},
  {name:'PatchCleaner (GUI)',folder:'Installer',tool:'PatchCleaner',savings:'2‚Äì6 GB',risk:'low',status:'done',
   cmd:'# Download: https://www.hendesoftware.com/patchcleaner.aspx\n# Move orphans to another drive rather than delete for safety.',
   note:'Recommended GUI tool. Detects orphaned vs active installer files safely. Move to another drive first.'},
  {name:'msizap Orphan Removal',folder:'Installer',tool:'msizap.exe',savings:'1‚Äì4 GB',risk:'medium',status:'pending',
   cmd:'msizap.exe G!',
   note:'Removes orphaned installer entries from registry and cache. Deprecated tool ‚Äî use only on older Windows systems.'},
  {name:'Disk Cleanup (basic)',folder:'Installer',tool:'cleanmgr',savings:'< 1 GB',risk:'low',status:'done',
   cmd:'cleanmgr /d C:',
   note:'Limited effectiveness for the Installer folder ‚Äî clears temp variants only, does not touch active installer files.'},
];

function riskBadge(r){
  const m={safe:'badge-safe safe',low:'badge-low low',medium:'badge-medium medium',danger:'badge-danger danger'};
  const l={safe:'SAFE',low:'LOW',medium:'MEDIUM',danger:'DANGER'};
  return `<span class="badge ${m[r]}" data-risk="${r}">${l[r]}</span>`;
}

function buildMethods(){
  const tbody=document.getElementById('methods-body');
  tbody.innerHTML='';
  methods.forEach((m,i)=>{
    const tr=document.createElement('tr');
    tr.className='exp-toggle-row';
    tr.setAttribute('data-risk',m.risk);
    tr.setAttribute('onclick',`expandRow(this,'mdetail-${i}')`);
    tr.innerHTML=`
      <td><span class="exp-toggle">‚ñ∂</span></td>
      <td><strong>${m.name}</strong></td>
      <td><span class="badge ${m.folder==='WinSxS'?'badge-done':'badge-medium'}">${m.folder}</span></td>
      <td class="td-mono">${m.tool}</td>
      <td>${m.savings}</td>
      <td>${riskBadge(m.risk)}</td>
      <td><span class="badge ${m.status==='done'?'badge-done':'badge-pending'}">${m.status==='done'?'AVAILABLE':'PENDING'}</span></td>`;
    const dr=document.createElement('tr');
    dr.className='detail-row';
    dr.innerHTML=`<td colspan="7"><div class="detail-inner" id="mdetail-${i}">
      <p style="color:var(--mu);font-size:13px;margin-bottom:12px">${m.note}</p>
      <div class="code-wrap"><pre class="code-block">${escHtml(m.cmd)}</pre><button class="copy-btn" onclick="event.stopPropagation();copyText(this.previousSibling.textContent,this)">Copy</button></div>
    </div></td>`;
    tbody.appendChild(tr);
    tbody.appendChild(dr);
  });
}

function escHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

// ‚îÄ‚îÄ NAV ‚îÄ‚îÄ
const pages=['overview','folders','methods','runs','about'];
function showPage(id,el){
  pages.forEach(p=>{
    document.getElementById('page-'+p)?.classList.remove('active');
  });
  document.getElementById('page-'+id)?.classList.add('active');
  document.querySelectorAll('.sb-link').forEach(b=>b.classList.remove('active'));
  if(el) el.classList.add('active');
}

// ‚îÄ‚îÄ FILTER ‚îÄ‚îÄ
let activeFilter='all';
function filterAll(chip){
  activeFilter='all';
  document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
  chip.classList.add('active');
  applyFilter();
}
function filterChip(chip,risk){
  activeFilter=risk;
  document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
  chip.classList.add('active');
  applyFilter();
}
function applyFilter(){
  document.querySelectorAll('tbody tr[data-risk]').forEach(tr=>{
    tr.style.display=(activeFilter==='all'||tr.dataset.risk===activeFilter)?'':'none';
    const next=tr.nextElementSibling;
    if(next?.classList.contains('detail-row')){
      next.style.display=tr.style.display;
    }
  });
}

// ‚îÄ‚îÄ SEARCH ‚îÄ‚îÄ
function searchTable(tblId,q){
  const q2=q.toLowerCase();
  document.querySelectorAll(`#${tblId} tbody tr`).forEach(tr=>{
    if(tr.classList.contains('detail-row')) return;
    const txt=tr.textContent.toLowerCase();
    const show=!q2||txt.includes(q2);
    tr.style.display=show?'':'none';
    const next=tr.nextElementSibling;
    if(next?.classList.contains('detail-row')) next.style.display=show?'':'none';
  });
}

// ‚îÄ‚îÄ SORT ‚îÄ‚îÄ
function sortTable(tblId,col){
  const tbl=document.getElementById(tblId);
  const tbody=tbl.querySelector('tbody');
  const rows=[...tbody.querySelectorAll('tr:not(.detail-row)')];
  const dir=tbl.dataset.sortDir==='asc'?'desc':'asc';
  tbl.dataset.sortDir=dir;
  rows.sort((a,b)=>{
    const at=a.cells[col]?.textContent.trim()||'';
    const bt=b.cells[col]?.textContent.trim()||'';
    const an=parseFloat(at),bn=parseFloat(bt);
    if(!isNaN(an)&&!isNaN(bn)) return dir==='asc'?an-bn:bn-an;
    return dir==='asc'?at.localeCompare(bt):bt.localeCompare(at);
  });
  rows.forEach(r=>{
    const next=r.nextElementSibling;
    tbody.appendChild(r);
    if(next?.classList.contains('detail-row')) tbody.appendChild(next);
  });
}

// ‚îÄ‚îÄ EXPAND ROW ‚îÄ‚îÄ
function expandRow(tr,detailId){
  const detail=document.getElementById(detailId);
  const isOpen=tr.classList.contains('expanded');
  tr.classList.toggle('expanded',!isOpen);
  if(detail){
    detail.classList.toggle('show',!isOpen);
    detail.closest('.detail-row').style.display='';
  }
}

// ‚îÄ‚îÄ COPY ‚îÄ‚îÄ
function copyText(txt,btn){
  navigator.clipboard?.writeText(txt.trim()).then(()=>{
    if(btn){
      btn.textContent='Copied!';
      btn.classList.add('ok');
      setTimeout(()=>{btn.textContent='Copy';btn.classList.remove('ok')},1500);
    }
  });
}
function copyCommand(){
  copyText('Dism.exe /online /Cleanup-Image /StartComponentCleanup');
  alert('Command copied to clipboard!');
}

// ‚îÄ‚îÄ EXPORT CSV ‚îÄ‚îÄ
function exportCSV(){
  const rows=[['Method','Folder','Tool','Est. Savings','Risk','Status'],...methods.map(m=>[m.name,m.folder,m.tool,m.savings,m.risk,m.status])];
  const csv=rows.map(r=>r.map(c=>`"${c}"`).join(',')).join('\n');
  const a=document.createElement('a');
  a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv);
  a.download='bloatkill-methods.csv';
  a.click();
}

// ‚îÄ‚îÄ RUN CLEANUP ‚îÄ‚îÄ
function runCleanup(){
  alert('bloatkill scan triggered!\n\nIn production this would dispatch a scheduled task or GitHub Actions workflow to scan WinSxS and Installer, then regenerate this dashboard.\n\nFor now ‚Äî copy a command from the Cleanup Methods tab and run it in an elevated PowerShell session.');
}

// ‚îÄ‚îÄ SHORTCUTS ‚îÄ‚îÄ
function toggleKP(){document.getElementById('kp').classList.toggle('show')}
document.addEventListener('keydown',e=>{
  if(e.target.tagName==='INPUT') return;
  const navBtns=[...document.querySelectorAll('.sb-link[onclick*=showPage]')];
  if(e.key==='1'&&navBtns[0]) navBtns[0].click();
  if(e.key==='2'&&navBtns[1]) navBtns[1].click();
  if(e.key==='3'&&navBtns[2]) navBtns[2].click();
  if(e.key==='4'&&navBtns[3]) navBtns[3].click();
  if(e.key==='5'&&navBtns[4]) navBtns[4].click();
  if(e.key==='Escape') document.getElementById('kp').classList.remove('show');
  if(e.key==='?') toggleKP();
  if(e.key==='/'){e.preventDefault();document.querySelector('.page.active input[type=text]')?.focus();}
});

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
buildMethods();
</script>
</body>
</html>
